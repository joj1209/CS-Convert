# 한글 식별자 → 백틱 래핑 도우미 (BigQuery)

- 화면: `backtick-wrapper.html`
- 스크립트: `js/backtick-wrapper.js`

이 문서는 **BigQuery에서 한글 식별자(변수/컬럼/테이블 등)를 안전하게 사용하기 위해** SQL 텍스트 내 한글이 포함된 식별자를 `` `...` ``로 감싸는 화면의 사용 방법과 변환 규칙을 설명합니다.

---

## 1) 왜 필요한가

BigQuery SQL에서는 다음과 같은 경우에 백틱(Backtick, `` ` ``)으로 식별자를 감싸는 것이 안전합니다.

- 공백/특수문자/예약어가 포함된 컬럼명/테이블명
- 한글(또는 비 ASCII)이 포함된 컬럼명/테이블명

예)

```sql
SELECT 등록순번ID FROM DW.한국테이블;
```

위 SQL은 환경/표기 방식에 따라 해석이 애매해질 수 있어, 아래처럼 바꾸는 것을 권장합니다.

```sql
SELECT `등록순번ID` FROM DW.`한국테이블`;
```

---

## 2) 화면 구성 / 사용 방법

### 입력
- 좌측 **변환전 SQL** 텍스트박스에 SQL을 붙여넣습니다.

### 실행
- **한글→백틱 변환** 버튼을 클릭합니다.

### 출력
- 우측 **변환후 SQL (BigQuery)** 영역에 결과가 표시됩니다.
- 기본 설정(자동복사 체크)에서는 변환 직후 결과가 **자동으로 클립보드에 복사**됩니다.

### 추가 버튼
- **초기화**: 입력/출력/카운트/상태 메시지를 비웁니다.
- **결과 복사**: 출력 영역 내용을 클립보드에 복사합니다.

---

## 3) 변환 규칙 (핵심)

### 3.1 어떤 토큰을 백틱으로 감싸는가

- **한글(ㄱ-ㅎ, ㅏ-ㅣ, 가-힣)이 1글자라도 포함된 식별자 토큰만** 백틱으로 감쌉니다.
- 식별자 토큰은 대략 다음 문자들로 구성된 연속 구간을 의미합니다.
  - 시작: 영문자, `_`, 한글
  - 이후: 영문자/숫자/`_`/`$`/한글

예)

- `vs건수` → `` `vs건수` ``
- `등록순번ID` → `` `등록순번ID` ``
- `DW.한국테이블` → `DW.` + `` `한국테이블` `` (세그먼트별)

### 3.2 이미 백틱이 있는 경우

- 기본 옵션(기존 백틱 유지)이 켜져 있으면 `` `...` `` 내부는 **그대로 유지**합니다.
- 즉, 이미 백틱이 있는 식별자를 중복으로 감싸지 않습니다.

---

## 4) 옵션 설명

화면 중간의 옵션은 “변환 대상에서 제외할 영역”을 제어합니다.

### 4.1 `따옴표 문자열( '...' ) 내부는 건너뛰기` (기본: ON)

- `'...'` 내부의 내용은 변환하지 않습니다.
- BigQuery 문자열 리터럴은 일반적으로 `'...'`이므로, **문자열 안의 한글을 실수로 백틱 처리하는 것**을 막습니다.

예)

```sql
SELECT '한국테이블' AS msg, 등록순번ID FROM DW.한국테이블;
```

결과(기본 옵션):

```sql
SELECT '한국테이블' AS msg, `등록순번ID` FROM DW.`한국테이블`;
```

### 4.2 `주석( --, /* */ ) 내부는 건너뛰기` (기본: ON)

- `-- ...` 라인 주석과 `/* ... */` 블록 주석 내부는 변환하지 않습니다.
- 주석 내부의 “설명용 한글”은 변환 대상이 아니므로 기본적으로 제외합니다.

### 4.3 `기존 백틱( `...` ) 내부는 유지` (기본: ON)

- 이미 백틱 처리된 영역은 변경하지 않습니다.
- 수동으로 정리한 백틱이 깨지는 것을 방지합니다.

### 4.4 `변환 후 자동복사` (기본: ON)

- 변환 버튼 클릭 후 결과를 자동으로 클립보드에 복사합니다.
- 브라우저 권한/보안 정책에 따라 자동 복사가 실패할 수 있으며, 실패 시 출력창이 자동 선택됩니다(그 상태에서 `Ctrl+C`).

---

## 5) 예시

### 예시 1: 샘플 SQL

입력:

```sql
BEGIN
  DECLARE vs_target_date DATE DEFAULT DATE('2025-12-10');
  SET vs건수 = DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY);

  SET vs변수 = (
    SELECT COUNT(1)
    FROM DW.한국테이블
    WHERE 등록순번ID = vs_target_date
  );

  SELECT vs건수 as record_count;
END;
```

출력(기본 옵션):

```sql
BEGIN
  DECLARE vs_target_date DATE DEFAULT DATE('2025-12-10');
  SET `vs건수` = DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY);

  SET `vs변수` = (
    SELECT COUNT(1)
    FROM DW.`한국테이블`
    WHERE `등록순번ID` = vs_target_date
  );

  SELECT `vs건수` as record_count;
END;
```

### 예시 2: 이미 백틱이 있는 경우

입력:

```sql
SELECT `등록순번ID`, 등록순번ID FROM DW.`한국테이블`;
```

출력:

```sql
SELECT `등록순번ID`, `등록순번ID` FROM DW.`한국테이블`;
```

---

## 6) 구현 방식(요약)

변환기는 SQL 텍스트를 왼쪽에서 오른쪽으로 스캔하면서 다음을 처리합니다.

1. (옵션 ON 시) 문자열/주석/백틱 내부를 “보호 구간”으로 보고 그 구간은 그대로 출력
2. 보호 구간이 아닌 곳에서 식별자 토큰을 발견하면
   - 토큰에 한글이 포함되어 있으면 `` `토큰` ``으로 출력
   - 없으면 토큰 그대로 출력

또한 식별자 토큰 단위로 처리하기 때문에 `DW.한국테이블`처럼 점으로 이어진 경로는 **세그먼트별로 자연스럽게 래핑**됩니다.

---

## 7) 제한/주의사항 (중요)

아래 케이스는 SQL 문법 전체를 파싱하는 도구가 아니기 때문에 제한이 있습니다.

- **하이픈(-)** 이 들어간 식별자(예: `my-table`)는 현재 토큰 규칙상 한 덩어리로 잡히지 않습니다.
  - 이런 경우에는 BigQuery 권장 방식대로 전체를 수동 백틱 처리(예: `` `my-table` ``)가 필요합니다.
- BigQuery에는 문자열이 아닌 다양한 리터럴/구문이 존재합니다.
  - 본 도구는 실무에서 흔한 `--`, `/* */`, `'...'`, `` `...` `` 보호만 우선 지원합니다.

---

## 8) 문제 해결

### 8.1 자동 복사가 실패합니다

브라우저 정책상 클립보드 쓰기는 다음 조건에 영향을 받습니다.

- `file://`로 직접 열었는지 여부
- HTTPS/localhost 여부
- 브라우저 권한 설정

실패 시에는 화면이 출력창을 자동 선택해주므로, 그대로 `Ctrl+C`를 누르시면 됩니다.

### 8.2 변환이 과하게/부족하게 됩니다

- 주석/문자열/백틱 보호 옵션을 확인하세요.
- 특수문자 포함 식별자는 수동 처리 영역일 수 있습니다(위 제한 참고).

---

## 9) 변경 이력

- 2026-02-03: 최초 추가(한글 토큰 백틱 래핑 + 자동복사 + 옵션)
